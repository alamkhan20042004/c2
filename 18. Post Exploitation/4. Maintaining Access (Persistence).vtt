WEBVTT

00:00.050 --> 00:01.320
Instructor: In all of the scenarios

00:01.320 --> 00:04.830
and videos we've done so far, we would lose our connection

00:04.830 --> 00:06.240
to the target computer

00:06.240 --> 00:09.450
as soon as the target person restarts their computer

00:09.450 --> 00:11.880
because we used a normal backdoor,

00:11.880 --> 00:13.920
and once they restart their computer,

00:13.920 --> 00:15.810
our backdoor will be terminated,

00:15.810 --> 00:19.440
the process will be terminated and will lose the connection.

00:19.440 --> 00:22.440
So in today's lecture we're going to talk about methods

00:22.440 --> 00:24.900
that will allow us to maintain our access

00:24.900 --> 00:26.340
to the target computer,

00:26.340 --> 00:28.470
so that we can come back at any time

00:28.470 --> 00:32.460
and regain our full control over that computer.

00:32.460 --> 00:34.950
So there's a number of methods to do that.

00:34.950 --> 00:37.650
The first one is using veil-evasion.

00:37.650 --> 00:39.810
We can use instead of the normal backdoor,

00:39.810 --> 00:42.120
the HTTP backdoor that we created.

00:42.120 --> 00:46.110
You can use a HTTP service or a TCP service.

00:46.110 --> 00:48.720
So I'll actually show you here.

00:48.720 --> 00:53.720
If I just run veil-evasion and do a list,

00:55.020 --> 00:59.313
you'll see that we have at number seven right here.

01:00.510 --> 01:03.780
And at number five we have service back doors.

01:03.780 --> 01:07.560
So you can use any of them, if I do use five,

01:07.560 --> 01:08.700
and we can see the info.

01:08.700 --> 01:11.010
All you have to do is just set up your LHOST,

01:11.010 --> 01:13.350
put the LHOSTS and then generate the backdoor.

01:13.350 --> 01:15.360
And once you generate it, you can use it

01:15.360 --> 01:16.950
and combine it with other stuff

01:16.950 --> 01:19.350
and send it to the target person, like we did,

01:19.350 --> 01:22.050
or you can upload it using the upload command

01:22.050 --> 01:24.540
that we learned and then execute it.

01:24.540 --> 01:26.100
And that will install the backdoor

01:26.100 --> 01:28.650
as a service on the target computer.

01:28.650 --> 01:31.890
So then all you need to do is use the multi handler

01:31.890 --> 01:34.350
and anytime the target computer starts,

01:34.350 --> 01:37.260
it'll try to connect back to you

01:37.260 --> 01:39.600
because this is a reverse shell.

01:39.600 --> 01:41.160
Now, I'm not gonna be explaining this method

01:41.160 --> 01:43.980
because this method is very simple.

01:43.980 --> 01:45.960
We've done something very similar to it before.

01:45.960 --> 01:48.180
We created backdoor using veil-evasion,

01:48.180 --> 01:50.430
and we uploaded stuff to the direct computer.

01:50.430 --> 01:52.620
So all you have to do is create the backdoor, upload it,

01:52.620 --> 01:54.660
execute it, and you're done.

01:54.660 --> 01:56.250
Also, it doesn't always work,

01:56.250 --> 01:58.530
so that's why I'm not gonna be explaining it.

01:58.530 --> 02:01.020
The normal back doors are much more reliable.

02:01.020 --> 02:04.830
That's why I used a normal backdoor

02:04.830 --> 02:06.510
when I was combining it with stuff

02:06.510 --> 02:08.850
and changing its icon and all that.

02:08.850 --> 02:10.110
So what we're going to do is

02:10.110 --> 02:12.720
we're going to use our backdoor,

02:12.720 --> 02:15.660
the normal HTTP reverse interpreter backdoor

02:15.660 --> 02:17.910
that we created in the first video

02:17.910 --> 02:20.010
when we created an undetectable backdoor.

02:20.010 --> 02:23.130
We're gonna use that and inject that as a service

02:23.130 --> 02:25.110
so that it runs every time

02:25.110 --> 02:26.940
the target person runs their computer

02:26.940 --> 02:28.770
and tries to connect back to us

02:28.770 --> 02:31.170
every certain amount of time.

02:31.170 --> 02:34.830
So to do this, I'm going to background the current session.

02:34.830 --> 02:36.270
So we've seen that before.

02:36.270 --> 02:39.330
You can do background and I can still interact with

02:39.330 --> 02:41.790
that session on number one.

02:41.790 --> 02:43.863
And I'm going to use a module.

02:45.240 --> 02:47.130
So this is like the multi handler module

02:47.130 --> 02:48.750
that comes in with meta exploit

02:48.750 --> 02:53.750
and it's called exploit/windows/local/persistence.

02:57.420 --> 02:58.620
Then I'm gonna show its options

02:58.620 --> 03:00.270
to see what we need to configure.

03:01.170 --> 03:03.750
So the first thing is the amount of seconds

03:03.750 --> 03:07.620
that the target will try to connect back to us.

03:07.620 --> 03:08.790
So the interval.

03:08.790 --> 03:10.590
And I'm gonna keep that to 10 seconds.

03:10.590 --> 03:12.690
So every 10 seconds the target computer

03:12.690 --> 03:15.030
will try to connect back to me.

03:15.030 --> 03:16.830
Now, the EXE name is the name

03:16.830 --> 03:18.990
that will show up under the processes

03:18.990 --> 03:21.990
where the connection is coming back from.

03:21.990 --> 03:24.930
So I'm gonna set that to browser

03:24.930 --> 03:27.570
to make it less detectable.

03:27.570 --> 03:31.900
So we're gonna set the EXE name to browser.exe

03:34.620 --> 03:38.040
and then the path where the payload

03:38.040 --> 03:39.450
or the backdoor will be installed,

03:39.450 --> 03:41.100
I'll leave that the same.

03:41.100 --> 03:44.160
I'll leave the reg name, the registry entry the same.

03:44.160 --> 03:45.540
Now, this is very important.

03:45.540 --> 03:50.010
You need to specify which session to run this exploit on.

03:50.010 --> 03:54.180
And as you can see now, we were using session number one.

03:54.180 --> 03:56.220
That's our interpreter session.

03:56.220 --> 03:59.340
And if I do sessions l,

03:59.340 --> 04:01.110
it'll list all the available sessions

04:01.110 --> 04:04.080
and we can see that it's ID number one.

04:04.080 --> 04:07.770
So what we need to do is we need to set our session here

04:07.770 --> 04:09.690
to number one.

04:09.690 --> 04:14.690
So I'm gonna do set session to one

04:16.650 --> 04:18.150
and the startup, we're gonna leave it

04:18.150 --> 04:21.900
for the user person for the user privileges.

04:21.900 --> 04:23.373
Now, let's show the options.

04:24.420 --> 04:28.020
So browser and the session number one, that's all good.

04:28.020 --> 04:30.210
Now, we need to specify the payload

04:30.210 --> 04:32.910
that will be injected as a service.

04:32.910 --> 04:37.910
So to do that we're going to do a show advanced.

04:38.370 --> 04:40.770
So show advanced will show you advanced options

04:40.770 --> 04:44.160
that you can set up for this particular module.

04:44.160 --> 04:45.960
So when I run this, you'll see I'll get

04:45.960 --> 04:47.640
so much more options.

04:47.640 --> 04:50.100
And the one that we're interested in is this one.

04:50.100 --> 04:53.880
So it's called EXE custom, which means that we're going

04:53.880 --> 04:56.610
to use a custom EXE to run

04:56.610 --> 05:00.033
and inject into the target computer as a service.

05:00.870 --> 05:05.870
So I'm gonna set my EXE custom

05:06.300 --> 05:11.300
to var/www/html/backdoor.exe.

05:12.060 --> 05:13.170
As you remember,

05:13.170 --> 05:18.170
I had that stored in var/www/html/backdoor.exe.

05:19.170 --> 05:20.880
So I'm gonna hit enter

05:20.880 --> 05:23.670
and I'm just gonna do show advanced again to make sure

05:23.670 --> 05:25.680
that it was set up properly,

05:25.680 --> 05:27.690
because sometimes I misspell things.

05:27.690 --> 05:30.720
And it's var/www/html/backdoor.exe.

05:30.720 --> 05:31.830
So that's perfect.

05:31.830 --> 05:33.360
Everything is good to go.

05:33.360 --> 05:34.630
I'm gonna exploit this

05:36.390 --> 05:41.070
and that will upload var/www/html/backdoor.exe

05:41.070 --> 05:44.640
on the target computer using the session that we specified,

05:44.640 --> 05:45.480
session number one.

05:45.480 --> 05:49.200
As you can see now, it's been uploaded and installed.

05:49.200 --> 05:51.030
And one important thing that you need

05:51.030 --> 05:53.430
to keep in mind is this resource file,

05:53.430 --> 05:55.410
because you can use this to clean up

05:55.410 --> 05:57.270
and delete the back door once you're done.

05:57.270 --> 05:58.650
So if you don't want the backdoor

05:58.650 --> 06:00.480
anymore on the target computer,

06:00.480 --> 06:03.600
you can use this file to delete that backdoor.

06:03.600 --> 06:06.180
So I'm gonna start that in a leaf pad here

06:06.180 --> 06:10.050
so that I can run it and delete my backdoor

06:10.050 --> 06:12.513
if I wanted to delete it anytime in the future.

06:13.770 --> 06:18.770
If I do sessions L, I still have my session here.

06:19.110 --> 06:20.280
So what I'm going to do is

06:20.280 --> 06:21.690
I'm actually gonna kill that session.

06:21.690 --> 06:23.253
I'm gonna kill all my sessions.

06:26.280 --> 06:28.440
And now if I list, I have no connections

06:28.440 --> 06:30.690
with the target computer, as you can see.

06:30.690 --> 06:33.690
And I'm going to go

06:33.690 --> 06:36.450
to use my exploit multi handler.

06:36.450 --> 06:39.030
I can listen for incoming connections

06:39.030 --> 06:41.580
and everything is configured correctly already on this.

06:41.580 --> 06:43.860
So I have my right port and my right IP.

06:43.860 --> 06:46.080
Now, if I exploit this right now,

06:46.080 --> 06:47.790
I'll get a connection straight away

06:47.790 --> 06:50.460
because my backdoor has been injected

06:50.460 --> 06:55.290
into the target computer on port 8080 on reverse HTTP.

06:55.290 --> 06:56.280
But I'm not gonna do that now.

06:56.280 --> 06:58.380
I'm actually gonna restart the target computer

06:58.380 --> 06:59.430
just to show you that

06:59.430 --> 07:02.730
I'll always have connection now with this computer.

07:02.730 --> 07:04.653
So I'm just gonna do a normal restart.

07:09.720 --> 07:11.730
So this computer will basically try to

07:11.730 --> 07:14.103
connect back to me every 10 seconds.

07:15.630 --> 07:18.480
No matter how many times they restart it, they shut it down,

07:18.480 --> 07:20.640
every time this computer is running,

07:20.640 --> 07:23.820
it'll try to connect back to me in every 10 seconds.

07:23.820 --> 07:27.420
So all I have to do is run my interpreter handler

07:27.420 --> 07:29.310
and wait for connections.

07:29.310 --> 07:31.050
Now, this computer is running, as you can see.

07:31.050 --> 07:33.810
It doesn't have to be at the startup when I'm listening,

07:33.810 --> 07:36.303
and I'm just gonna do exploit to listen.

07:38.520 --> 07:40.500
And it'll take a maximum of 10 seconds

07:40.500 --> 07:41.520
to get a connection back.

07:41.520 --> 07:43.350
And as you can see, I got a connection

07:43.350 --> 07:46.200
to the target computer, I can do sysinfo,

07:46.200 --> 07:48.480
and run all the commands that we learned so far

07:48.480 --> 07:50.853
and have full access on that computer.
