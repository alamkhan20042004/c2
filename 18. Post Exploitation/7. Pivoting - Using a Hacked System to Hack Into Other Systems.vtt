WEBVTT

1
00:00:00.000 --> 00:00:01.928
<v Instructor>Now that we understand the concept</v>

2
00:00:01.928 --> 00:00:05.930
of pivoting, it's really not that difficult to perform.

3
00:00:05.930 --> 00:00:09.190
All we need to do is we can upload any tool we need to use,

4
00:00:09.190 --> 00:00:11.460
for example, if you wanted to use Nmap

5
00:00:11.460 --> 00:00:14.000
or ARP spoof or dSniff,

6
00:00:14.000 --> 00:00:15.780
you can upload any of these tools,

7
00:00:15.780 --> 00:00:17.200
run them on this computer,

8
00:00:17.200 --> 00:00:19.610
which is connected to this big network,

9
00:00:19.610 --> 00:00:22.480
and then you can run a port scanner on this,

10
00:00:22.480 --> 00:00:24.320
you can do ARP poisoning,

11
00:00:24.320 --> 00:00:27.140
and do man-in-the-middle attacks like we learned before.

12
00:00:27.140 --> 00:00:28.790
So it's very simple.

13
00:00:28.790 --> 00:00:31.210
All you have to do is use the upload command,

14
00:00:31.210 --> 00:00:33.930
upload it here and use it from the command line,

15
00:00:33.930 --> 00:00:37.820
like we were using it anyway in the previous videos.

16
00:00:37.820 --> 00:00:39.010
What I'm gonna show you today

17
00:00:39.010 --> 00:00:41.300
is how to set up a route

18
00:00:41.300 --> 00:00:45.120
between the hacked computer and your computer

19
00:00:45.120 --> 00:00:48.090
so that you can use any Metasploit auxiliary

20
00:00:48.090 --> 00:00:51.240
or module against this big network.

21
00:00:51.240 --> 00:00:53.550
So we'll be able to use Metasploit exploits,

22
00:00:53.550 --> 00:00:55.650
we'll be able to use port scanners

23
00:00:55.650 --> 00:00:57.150
that come in with Metasploit

24
00:00:57.150 --> 00:00:58.923
and other useful modules.

25
00:00:59.780 --> 00:01:03.270
To do that, we're gong to use a module called autoroute.

26
00:01:03.270 --> 00:01:06.860
Let me show you first how if I try to run an exploit

27
00:01:06.860 --> 00:01:10.060
on the target computer, on the Metasploitable computer,

28
00:01:10.060 --> 00:01:13.400
it's not gonna work because it's not visible to me.

29
00:01:13.400 --> 00:01:16.490
So I'm gonna do a sessions list

30
00:01:16.490 --> 00:01:18.410
and you'll see that I already have a connection

31
00:01:18.410 --> 00:01:19.730
with the Windows computer here.

32
00:01:19.730 --> 00:01:21.670
So I've already hacked it.

33
00:01:21.670 --> 00:01:26.670
And I'm going to use exploit/multi/samba

34
00:01:30.070 --> 00:01:31.390
and usermap_script.

35
00:01:31.390 --> 00:01:33.190
Now, we already used this exploit

36
00:01:33.190 --> 00:01:35.000
against the Metasploitable before

37
00:01:35.000 --> 00:01:36.450
but it was on the same network,

38
00:01:36.450 --> 00:01:38.070
so it was visible to us.

39
00:01:38.070 --> 00:01:39.660
What we're doing now is trying

40
00:01:39.660 --> 00:01:43.290
to attack a device that is not visible to us.

41
00:01:43.290 --> 00:01:45.040
And then I'm gonna do show options.

42
00:01:47.490 --> 00:01:52.490
I'm gonna set my RHOST to 10.20.15.4

43
00:01:52.560 --> 00:01:55.880
because that's the IP of the Metasploitable device.

44
00:01:55.880 --> 00:01:57.480
Then I'm gonna do show payloads.

45
00:02:01.300 --> 00:02:05.368
And I'm going to use this payload right here.

46
00:02:05.368 --> 00:02:10.203
So I'm gonna do set PAYLOAD to this.

47
00:02:11.430 --> 00:02:12.693
Show options.

48
00:02:14.420 --> 00:02:15.810
Everything's set up properly,

49
00:02:15.810 --> 00:02:17.333
so I'm gonna do exploit.

50
00:02:20.830 --> 00:02:23.470
And you'll see that this exploit will time out

51
00:02:23.470 --> 00:02:26.980
because if we go back to the diagram here,

52
00:02:26.980 --> 00:02:29.660
this device cannot see this device.

53
00:02:29.660 --> 00:02:31.720
So it's trying to run an exploit on this device,

54
00:02:31.720 --> 00:02:34.770
even though this device has that vulnerability

55
00:02:34.770 --> 00:02:36.970
but I won't be able to use it

56
00:02:36.970 --> 00:02:39.363
because I can't see that device.

57
00:02:43.080 --> 00:02:44.830
And as you can see now,

58
00:02:44.830 --> 00:02:47.070
the exploit failed, connection timeout.

59
00:02:47.070 --> 00:02:49.750
We just couldn't connect to the target computer.

60
00:02:49.750 --> 00:02:50.970
So what I'm going to do now,

61
00:02:50.970 --> 00:02:53.820
I'm gonna interact with my Meterpreter on ID one.

62
00:02:53.820 --> 00:02:55.790
So sessions -i 1.

63
00:02:57.040 --> 00:02:58.490
So I'm in my Meterpreter.

64
00:02:58.490 --> 00:03:00.410
I'm gonna run ifconfig first

65
00:03:00.410 --> 00:03:02.870
to see what my network look like

66
00:03:02.870 --> 00:03:05.743
or the networks that the target computer is connected to.

67
00:03:07.470 --> 00:03:09.640
So we can see all the interfaces connected

68
00:03:09.640 --> 00:03:11.080
to the target computer.

69
00:03:11.080 --> 00:03:14.280
And I'm gonna look for interfaces with IP addresses.

70
00:03:14.280 --> 00:03:17.870
So we have this interface number four has an IP address.

71
00:03:17.870 --> 00:03:19.910
And we can see that this IP address

72
00:03:19.910 --> 00:03:21.330
is on our network.

73
00:03:21.330 --> 00:03:23.590
So it's really not very useful.

74
00:03:23.590 --> 00:03:24.800
It's already on our network.

75
00:03:24.800 --> 00:03:28.390
We're on the 10.20.14 anyway, on that subnet.

76
00:03:28.390 --> 00:03:31.240
So this one is not very useful for me.

77
00:03:31.240 --> 00:03:32.500
Another one that I can see

78
00:03:32.500 --> 00:03:37.500
is this one, which is connected to 10.20.15.5.

79
00:03:38.010 --> 00:03:40.520
So it's on a different subnet right here,

80
00:03:40.520 --> 00:03:44.060
which I cannot see from my Kali Linux device.

81
00:03:44.060 --> 00:03:46.200
So I'm going to try to set up a route

82
00:03:46.200 --> 00:03:49.243
between this subnet and my current subnet.

83
00:03:50.200 --> 00:03:52.190
So I'm gonna copy this.

84
00:03:52.190 --> 00:03:55.390
And then I'm going to background my current session,

85
00:03:55.390 --> 00:03:56.740
so I'm back into Metasploit

86
00:03:57.700 --> 00:03:58.723
and I'll clear this.

87
00:03:59.600 --> 00:04:02.890
Then I'm going to use post/manage.

88
00:04:08.080 --> 00:04:10.310
Now, by the way, at any stage of this,

89
00:04:10.310 --> 00:04:12.390
if you wanted to see all of the manage modules,

90
00:04:12.390 --> 00:04:14.690
for example, you can just leave it at this

91
00:04:14.690 --> 00:04:15.600
and double tap

92
00:04:16.700 --> 00:04:18.880
and you'll see all the manage modules

93
00:04:18.880 --> 00:04:22.560
and you can try and use them and experiment with them.

94
00:04:22.560 --> 00:04:25.543
So our one that we want to use is autoroute.

95
00:04:27.520 --> 00:04:29.860
And I'm gonna do show options

96
00:04:29.860 --> 00:04:32.090
to see the options that I can set.

97
00:04:32.090 --> 00:04:34.160
And we have two options that we need to set.

98
00:04:34.160 --> 00:04:37.210
We need to set the session that we have

99
00:04:37.210 --> 00:04:38.403
and the subnet.

100
00:04:39.300 --> 00:04:41.050
So I'm gonna set the session first.

101
00:04:42.810 --> 00:04:44.263
And it's session number one.

102
00:04:45.650 --> 00:04:47.270
And then I'm gonna set the subnet

103
00:04:47.270 --> 00:04:50.410
to what we've seen when we did the ifconfig command.

104
00:04:50.410 --> 00:04:54.263
It was 10.20.15 and I'm gonna put a zero to it.

105
00:04:55.200 --> 00:04:56.680
So again, we're using the set,

106
00:04:56.680 --> 00:04:58.700
very simple commands we already learned.

107
00:04:58.700 --> 00:05:00.650
We're setting the session to number one.

108
00:05:00.650 --> 00:05:03.690
That's the session that we hacked for the Windows.

109
00:05:03.690 --> 00:05:05.920
And the subnet is the subnet,

110
00:05:05.920 --> 00:05:08.410
which the Windows is connected to

111
00:05:08.410 --> 00:05:09.840
and we don't have access to.

112
00:05:09.840 --> 00:05:12.033
So it's the 10.20.15.0.

113
00:05:13.410 --> 00:05:14.683
And I'm gonna do exploit.

114
00:05:18.360 --> 00:05:23.000
And this will create the connection

115
00:05:23.000 --> 00:05:27.370
or the route between my device and the Windows device.

116
00:05:27.370 --> 00:05:28.560
So what I'm going to do now,

117
00:05:28.560 --> 00:05:30.350
I'm gonna go back to the same exploit

118
00:05:30.350 --> 00:05:32.440
that I tried at the start of the video

119
00:05:32.440 --> 00:05:35.190
and you'll see that the exploit is going to work

120
00:05:35.190 --> 00:05:38.910
because the Windows device is visible to me now.

121
00:05:38.910 --> 00:05:40.570
So instead of using the exploit,

122
00:05:40.570 --> 00:05:43.040
you can use, as I said, port scanners

123
00:05:43.040 --> 00:05:45.750
or discovery models

124
00:05:45.750 --> 00:05:47.180
that come in with Metasploit

125
00:05:47.180 --> 00:05:49.740
or any other module that come with Metasploit

126
00:05:49.740 --> 00:05:53.430
because my device can now see the target computer.

127
00:05:53.430 --> 00:05:56.320
It can see this Metasploitable device

128
00:05:56.320 --> 00:05:59.130
because it was not visible for me at the start

129
00:05:59.130 --> 00:06:01.490
but now I have a connection to this computer

130
00:06:01.490 --> 00:06:02.780
and I set up a route

131
00:06:02.780 --> 00:06:04.950
between this network and my computer

132
00:06:04.950 --> 00:06:08.370
so I can actually see the Metasploitable device now.

133
00:06:08.370 --> 00:06:11.343
So I'm going to use the same exploit I used before.

134
00:06:13.940 --> 00:06:17.660
And it was exploit/multi/samba/usermap_script.

135
00:06:17.660 --> 00:06:18.493
Just clear that.

136
00:06:19.590 --> 00:06:20.900
Now, I'm gonna show the options

137
00:06:20.900 --> 00:06:22.060
and I'm gonna leave them the same

138
00:06:22.060 --> 00:06:24.460
because everything is actually set up correctly.

139
00:06:25.690 --> 00:06:27.293
So I'm just gonna do exploit.

140
00:06:29.240 --> 00:06:33.780
And as you can see, now command shell was started properly

141
00:06:33.780 --> 00:06:36.710
and I actually have access to the Metasploitable device now,

142
00:06:36.710 --> 00:06:39.200
so I can do id and I'm root.

143
00:06:39.200 --> 00:06:43.693
I can do a uname -a to just confirm that for you.

144
00:06:44.980 --> 00:06:47.440
And we can see that we're in the Metasploitable device

145
00:06:47.440 --> 00:06:49.930
and I can run any Linux command that I want.

146
00:06:49.930 --> 00:06:54.930
So I can do ls, pwd and I should be in the root.

147
00:06:56.010 --> 00:06:59.200
And I can do cd, go to var, for example.

148
00:06:59.200 --> 00:07:01.390
And do any Linux command that I want.

149
00:07:01.390 --> 00:07:04.503
So I basically have full access to the target computer.

150
00:07:05.710 --> 00:07:08.110
Now again, as I said, you could upload stuff

151
00:07:08.110 --> 00:07:09.610
and run them from the target computer

152
00:07:09.610 --> 00:07:11.740
but it's not always a good idea to upload things

153
00:07:11.740 --> 00:07:13.170
to a hacked computer.

154
00:07:13.170 --> 00:07:15.160
So setting up the routes like this

155
00:07:15.160 --> 00:07:18.163
and using pivoting is a much safer choice.

156
00:07:20.000 --> 00:07:22.064
And I highly recommend that you go

157
00:07:22.064 --> 00:07:24.610
and have a look on other Metasploitable modules

158
00:07:24.610 --> 00:07:27.300
because Metasploit is really, really big.

159
00:07:27.300 --> 00:07:28.860
It's hard for me to cover everything.

160
00:07:28.860 --> 00:07:30.960
I just covered the main basic stuff

161
00:07:30.960 --> 00:07:32.320
but you can always just go in

162
00:07:32.320 --> 00:07:34.870
and have a look on other modules and try them.

163
00:07:34.870 --> 00:07:36.772
Using the modules is usually the same.

164
00:07:36.772 --> 00:07:40.040
We had a look on a broad array of modules.

165
00:07:40.040 --> 00:07:43.350
So it should be asy to just configure options

166
00:07:43.350 --> 00:07:45.363
and run these modules the way you want.

